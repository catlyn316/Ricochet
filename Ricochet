-- ã€å¹³æ¿çµ‚æ¥µæ’é£›è…³æœ¬ v5.3ã€‘ç¾åŒ–ç‰ˆ + ä¿®å¾©è§¸ç¢°æ¨¡å¼
local Players = game:GetService("Players")
local UIS = game:GetService("UserInputService")
local Workspace = game:GetService("Workspace")
local RunService = game:GetService("RunService")
local player = Players.LocalPlayer
local cam = Workspace.CurrentCamera

-- ================== è¨­å®šå€ ==================
local ENABLED = false
local MODE = "é»æ“Š"
local FLY_POWER = 16000
local UP_POWER = 6000
local EXPLOSION_RADIUS = 15
local TOUCH_MASS = 500000  -- å¤§å¹…æå‡åˆ°50è¬

-- é«˜äº®ç³»çµ±
local highlights = {}
local SCAN_INTERVAL = 1.0
local lastScan = 0
local maxHighlights = 30
local SCAN_RADIUS = 100  -- æ“´å¤§åˆ°100æ ¼

-- ç¯„åœæ¨¡å¼è¨ˆæ™‚å™¨
local lastExplosion = 0
local EXPLOSION_INTERVAL = 0.15
local flingCooldowns = {}
local rangeModeTrigger = true  -- ç”¨æ–¼ç¢ºä¿ç¯„åœæ¨¡å¼èƒ½ç«‹å³è§¸ç™¼

-- è§¸ç¢°æ¨¡å¼ç”¨ï¼ˆä¿®å¾©ç‰ˆï¼‰
local massConnection = nil
local spinConnection = nil  -- æ—‹è½‰é€£æ¥

-- ================== åˆ¤æ–·æ˜¯å¦å¯å½ˆé£› ==================
local function canBeFlung(part)
    if not part:IsA("BasePart") then return false end
    if part.Anchored then return false end
    if not part.Parent then return false end
    
    -- éæ¿¾ç©å®¶è§’è‰²
    local char = player.Character
    if char and part:IsDescendantOf(char) then return false end
    
    -- éæ¿¾å…¶ä»–ç©å®¶
    for _, p in ipairs(Players:GetPlayers()) do
        if p.Character and part:IsDescendantOf(p.Character) then
            return false
        end
    end
    
    -- æª¢æŸ¥æ˜¯å¦æœ‰åº§ä½ä¸”æœ‰äººå
    local seat = part:FindFirstChildOfClass("Seat") or part:FindFirstChildOfClass("VehicleSeat")
    if seat and seat.Occupant then
        return false
    end
    
    -- æª¢æŸ¥çˆ¶ç‰©ä»¶æ˜¯å¦æœ‰åº§ä½
    if part.Parent then
        for _, child in ipairs(part.Parent:GetChildren()) do
            if child:IsA("Seat") or child:IsA("VehicleSeat") then
                if child.Occupant then
                    return false
                end
            end
        end
    end
    
    -- éæ¿¾åœ°å½¢å’Œç‰¹æ®Šç‰©é«”
    if part:IsA("Terrain") then return false end
    if part.Name == "Baseplate" or part.Name == "Base" then return false end
    if part.AssemblyMass > 5000 then return false end
    
    return true
end

-- ================== é«˜äº®ç³»çµ± ==================
local function createHighlight(part)
    if highlights[part] then return end
    
    local highlight = Instance.new("Highlight")
    highlight.Adornee = part
    highlight.FillTransparency = 1
    highlight.OutlineColor = Color3.new(0, 1, 0)
    highlight.OutlineTransparency = 0
    highlight.Parent = cam
    highlights[part] = highlight
end

local function removeHighlight(part)
    if highlights[part] then
        highlights[part]:Destroy()
        highlights[part] = nil
    end
end

local function scanUnanchoredParts()
    local char = player.Character
    if not char then return end
    
    local hrp = char:FindFirstChild("HumanoidRootPart")
    if not hrp then return end
    
    local playerPos = hrp.Position
    
    -- ä½¿ç”¨ Region3 åªæƒæé™„è¿‘å€åŸŸï¼Œä¸æƒæå…¨åœ°åœ–
    local region = Region3.new(
        playerPos - Vector3.new(SCAN_RADIUS, SCAN_RADIUS, SCAN_RADIUS),
        playerPos + Vector3.new(SCAN_RADIUS, SCAN_RADIUS, SCAN_RADIUS)
    )
    region = region:ExpandToGrid(4)
    
    local parts = Workspace:FindPartsInRegion3(region, char, 100)
    local candidates = {}
    
    -- åªè™•ç†é™„è¿‘çš„ç‰©é«”
    for _, obj in ipairs(parts) do
        if canBeFlung(obj) then
            local distance = (obj.Position - playerPos).Magnitude
            if distance <= SCAN_RADIUS then
                table.insert(candidates, {part = obj, distance = distance})
            end
        end
    end
    
    -- æŒ‰è·é›¢æ’åº
    table.sort(candidates, function(a, b)
        return a.distance < b.distance
    end)
    
    -- åªæ¨™è¨˜æœ€è¿‘çš„30å€‹
    local count = 0
    for _, data in ipairs(candidates) do
        if count >= maxHighlights then break end
        createHighlight(data.part)
        count = count + 1
    end
end

local function updateHighlights()
    -- å¿«é€Ÿæ¸…ç†ï¼šåªæª¢æŸ¥å·²æ¨™è¨˜çš„ç‰©é«”
    for part, hl in pairs(highlights) do
        if not canBeFlung(part) then
            removeHighlight(part)
        end
    end
end

-- ================== å½ˆé£›åŠŸèƒ½ ==================
local function flingPart(part)
    if not canBeFlung(part) then return end
    
    part:ApplyImpulse(
        cam.CFrame.LookVector * FLY_POWER * part.AssemblyMass + 
        Vector3.new(0, UP_POWER * part.AssemblyMass, 0)
    )
    
    part:ApplyAngularImpulse(Vector3.new(
        math.random(-100000, 100000),
        math.random(-100000, 100000),
        math.random(-100000, 100000)
    ))
end

-- ç¯„åœçˆ†ç‚¸ï¼ˆä»¥ç©å®¶ç‚ºä¸­å¿ƒï¼Œå„ªåŒ–ç‰ˆï¼‰
local function explosionFlingAroundPlayer()
    local char = player.Character
    if not char then return end
    
    local hrp = char:FindFirstChild("HumanoidRootPart")
    if not hrp then return end
    
    local playerPos = hrp.Position
    local now = tick()
    local flingCount = 0
    local maxFlings = 20  -- æ¯æ¬¡æœ€å¤šå½ˆé£›20å€‹ç‰©é«”ï¼Œé¿å…å¡é “
    
    -- ä½¿ç”¨Region3å„ªåŒ–ï¼ˆåªæƒæç¯„åœå…§çš„ç‰©é«”ï¼‰
    local region = Region3.new(
        playerPos - Vector3.new(EXPLOSION_RADIUS, EXPLOSION_RADIUS, EXPLOSION_RADIUS),
        playerPos + Vector3.new(EXPLOSION_RADIUS, EXPLOSION_RADIUS, EXPLOSION_RADIUS)
    )
    region = region:ExpandToGrid(4)
    
    local parts = Workspace:FindPartsInRegion3(region, char, 100)
    
    for _, obj in ipairs(parts) do
        if flingCount >= maxFlings then break end
        
        if canBeFlung(obj) then
            local distance = (obj.Position - playerPos).Magnitude
            
            if distance <= EXPLOSION_RADIUS then
                -- æª¢æŸ¥å†·å»æ™‚é–“ï¼ˆé¿å…é‡è¤‡å½ˆé£›ï¼‰
                local lastFling = flingCooldowns[obj] or 0
                if now - lastFling >= 0.5 then  -- æ¯å€‹ç‰©é«”0.5ç§’æ‰èƒ½å†æ¬¡è¢«å½ˆé£›
                    local direction = (obj.Position - playerPos).Unit
                    local force = (1 - distance / EXPLOSION_RADIUS) * FLY_POWER
                    
                    obj:ApplyImpulse(
                        direction * force * obj.AssemblyMass + 
                        Vector3.new(0, UP_POWER * obj.AssemblyMass, 0)
                    )
                    
                    obj:ApplyAngularImpulse(Vector3.new(
                        math.random(-100000, 100000),
                        math.random(-100000, 100000),
                        math.random(-100000, 100000)
                    ))
                    
                    flingCooldowns[obj] = now
                    flingCount = flingCount + 1
                end
            end
        end
    end
    
    -- æ¸…ç†å·²éŠ·æ¯€ç‰©é«”çš„å†·å»è¨˜éŒ„
    for part, time in pairs(flingCooldowns) do
        if not part.Parent or now - time > 2 then
            flingCooldowns[part] = nil
        end
    end
end

-- è§¸ç¢°æ¨¡å¼ï¼šåªä¿®æ”¹HumanoidRootPartï¼ˆä¿®å¾©ç‰ˆï¼‰
local function enableTouchMode()
    local char = player.Character
    if not char then return end
    
    local hrp = char:FindFirstChild("HumanoidRootPart")
    if not hrp then return end
    
    -- åªä¿®æ”¹HRPï¼Œé¿å…å½±éŸ¿æ•´é«”ç‰©ç†
    hrp.CustomPhysicalProperties = PhysicalProperties.new(
        TOUCH_MASS / hrp.Size.X / hrp.Size.Y / hrp.Size.Z,
        0.3, 0, 1, 1
    )
    
    -- åŠ å…¥é«˜é€Ÿæ—‹è½‰
    if not spinConnection then
        spinConnection = RunService.Heartbeat:Connect(function()
            if MODE ~= "è§¸ç¢°" or not ENABLED then 
                if spinConnection then
                    spinConnection:Disconnect()
                    spinConnection = nil
                end
                return 
            end
            
            local currentChar = player.Character
            if not currentChar then return end
            
            local currentHrp = currentChar:FindFirstChild("HumanoidRootPart")
            if currentHrp then
                -- æ–½åŠ æŒçºŒçš„æ—‹è½‰åŠ›çŸ©
                currentHrp:ApplyAngularImpulse(Vector3.new(0, 50000, 0))
            end
        end)
    end
end

local function disableTouchMode()
    local char = player.Character
    if not char then return end
    
    local hrp = char:FindFirstChild("HumanoidRootPart")
    if hrp then
        hrp.CustomPhysicalProperties = nil
        hrp.AssemblyAngularVelocity = Vector3.new(0, 0, 0)  -- åœæ­¢æ—‹è½‰
    end
    
    -- åœæ­¢æ—‹è½‰é€£æ¥
    if spinConnection then
        spinConnection:Disconnect()
        spinConnection = nil
    end
end

-- ================== ç¾åŒ–GUIä»‹é¢ ==================
local function createGUI()

-- ================== è§’è‰²é‡ç”Ÿè™•ç† ==================
player.CharacterAdded:Connect(function(character)
    -- ç­‰å¾…è§’è‰²å®Œå…¨è¼‰å…¥
    character:WaitForChild("HumanoidRootPart")
    task.wait(0.5)
    
    -- ä¿æŒåŸæœ‰ç‹€æ…‹å’Œæ¨¡å¼ï¼Œä¸é‡ç½®
    if ENABLED then
        -- é‡æ–°æƒæç¶ æ¡†
        task.spawn(scanUnanchoredParts)
    end
    
    -- å¦‚æœæ˜¯è§¸ç¢°æ¨¡å¼ï¼Œé‡æ–°å•Ÿç”¨
    if MODE == "è§¸ç¢°" then
        task.wait(0.2)
        enableTouchMode()
    end
end)
    local sg = Instance.new("ScreenGui")
    sg.Name = "FlingGUI"
    sg.ResetOnSpawn = false
    sg.Parent = player:WaitForChild("PlayerGui")

    -- ä¸»å®¹å™¨ï¼ˆåœ“è§’èƒŒæ™¯ï¼‰- ç¸®å°ç‰ˆ
    local mainFrame = Instance.new("Frame")
    mainFrame.Size = UDim2.new(0, 200, 0, 370)
    mainFrame.Position = UDim2.new(0, 15, 0, 15)
    mainFrame.BackgroundColor3 = Color3.fromRGB(25, 25, 35)
    mainFrame.BorderSizePixel = 0
    mainFrame.Parent = sg
    
    local mainCorner = Instance.new("UICorner")
    mainCorner.CornerRadius = UDim.new(0, 15)
    mainCorner.Parent = mainFrame
    
    local mainStroke = Instance.new("UIStroke")
    mainStroke.Color = Color3.fromRGB(100, 100, 120)
    mainStroke.Thickness = 2
    mainStroke.Parent = mainFrame

    -- æ¨™é¡Œæ¬„ï¼ˆå¯æ‹–æ‹½å€åŸŸï¼‰
    local titleBar = Instance.new("Frame")
    titleBar.Size = UDim2.new(1, 0, 0, 42)
    titleBar.BackgroundColor3 = Color3.fromRGB(35, 35, 45)
    titleBar.BorderSizePixel = 0
    titleBar.Parent = mainFrame
    
    local titleBarCorner = Instance.new("UICorner")
    titleBarCorner.CornerRadius = UDim.new(0, 15)
    titleBarCorner.Parent = titleBar

    -- æ¨™é¡Œæ–‡å­—
    local title = Instance.new("TextLabel")
    title.Size = UDim2.new(1, -75, 1, 0)
    title.Position = UDim2.new(0, 12, 0, 0)
    title.BackgroundTransparency = 1
    title.TextColor3 = Color3.fromRGB(255, 255, 255)
    title.Font = Enum.Font.GothamBold
    title.TextSize = 16
    title.Text = "ğŸš€ æ’é£› v5.4"
    title.TextXAlignment = Enum.TextXAlignment.Left
    title.Parent = titleBar

    -- é—œé–‰æŒ‰éˆ•
    local btnClose = Instance.new("TextButton")
    btnClose.Size = UDim2.new(0, 30, 0, 30)
    btnClose.Position = UDim2.new(1, -36, 0, 6)
    btnClose.BackgroundColor3 = Color3.fromRGB(220, 50, 80)
    btnClose.TextColor3 = Color3.new(1,1,1)
    btnClose.Font = Enum.Font.GothamBold
    btnClose.TextSize = 16
    btnClose.Text = "X"
    btnClose.BorderSizePixel = 0
    btnClose.Parent = titleBar
    
    local btnCloseCorner = Instance.new("UICorner")
    btnCloseCorner.CornerRadius = UDim.new(0, 6)
    btnCloseCorner.Parent = btnClose

    -- ç¸®å°æŒ‰éˆ•
    local btnMinimize = Instance.new("TextButton")
    btnMinimize.Size = UDim2.new(0, 30, 0, 30)
    btnMinimize.Position = UDim2.new(1, -70, 0, 6)
    btnMinimize.BackgroundColor3 = Color3.fromRGB(100, 150, 255)
    btnMinimize.TextColor3 = Color3.new(1,1,1)
    btnMinimize.Font = Enum.Font.GothamBold
    btnMinimize.TextSize = 16
    btnMinimize.Text = "âˆ’"
    btnMinimize.BorderSizePixel = 0
    btnMinimize.Parent = titleBar
    
    local btnMinimizeCorner = Instance.new("UICorner")
    btnMinimizeCorner.CornerRadius = UDim.new(0, 6)
    btnMinimizeCorner.Parent = btnMinimize

    -- å…§å®¹å®¹å™¨
    local contentFrame = Instance.new("Frame")
    contentFrame.Size = UDim2.new(1, 0, 1, -42)
    contentFrame.Position = UDim2.new(0, 0, 0, 42)
    contentFrame.BackgroundTransparency = 1
    contentFrame.Parent = mainFrame

    -- ä¸»é–‹é—œæŒ‰éˆ•ï¼ˆç¸®å°ç‰ˆï¼‰
    local btnMain = Instance.new("TextButton")
    btnMain.Size = UDim2.new(1, -16, 0, 55)
    btnMain.Position = UDim2.new(0, 8, 0, 8)
    btnMain.BackgroundColor3 = Color3.fromRGB(220, 50, 80)
    btnMain.TextColor3 = Color3.new(1,1,1)
    btnMain.Font = Enum.Font.GothamBold
    btnMain.TextSize = 18
    btnMain.Text = "â— é—œé–‰"
    btnMain.BorderSizePixel = 0
    btnMain.Parent = contentFrame
    
    local btnMainCorner = Instance.new("UICorner")
    btnMainCorner.CornerRadius = UDim.new(0, 10)
    btnMainCorner.Parent = btnMain
    
    local btnMainGradient = Instance.new("UIGradient")
    btnMainGradient.Color = ColorSequence.new{
        ColorSequenceKeypoint.new(0, Color3.fromRGB(255, 255, 255)),
        ColorSequenceKeypoint.new(1, Color3.fromRGB(200, 200, 200))
    }
    btnMainGradient.Rotation = 90
    btnMainGradient.Parent = btnMain

    -- æ¨¡å¼åˆ‡æ›æŒ‰éˆ•
    local btnMode = Instance.new("TextButton")
    btnMode.Size = UDim2.new(1, -16, 0, 45)
    btnMode.Position = UDim2.new(0, 8, 0, 70)
    btnMode.BackgroundColor3 = Color3.fromRGB(70, 130, 255)
    btnMode.TextColor3 = Color3.new(1,1,1)
    btnMode.Font = Enum.Font.GothamBold
    btnMode.TextSize = 16
    btnMode.Text = "ğŸ¯ æ¨¡å¼ï¼šé»æ“Š"
    btnMode.BorderSizePixel = 0
    btnMode.Parent = contentFrame
    
    local btnModeCorner = Instance.new("UICorner")
    btnModeCorner.CornerRadius = UDim.new(0, 8)
    btnModeCorner.Parent = btnMode

    -- æ»‘æ¡¿é€šç”¨å‡½æ•¸
    local function createSlider(position, labelText, color, min, max, default, valueVar)
        local container = Instance.new("Frame")
        container.Size = UDim2.new(1, -16, 0, 55)
        container.Position = position
        container.BackgroundTransparency = 1
        container.Parent = contentFrame
        
        local label = Instance.new("TextLabel")
        label.Size = UDim2.new(1, 0, 0, 20)
        label.BackgroundTransparency = 1
        label.TextColor3 = Color3.fromRGB(200, 200, 220)
        label.Font = Enum.Font.GothamBold
        label.TextSize = 13
        label.Text = labelText .. math.floor(default)
        label.TextXAlignment = Enum.TextXAlignment.Left
        label.Parent = container
        
        local sliderBg = Instance.new("Frame")
        sliderBg.Size = UDim2.new(1, 0, 0, 26)
        sliderBg.Position = UDim2.new(0, 0, 0, 24)
        sliderBg.BackgroundColor3 = Color3.fromRGB(40, 40, 50)
        sliderBg.BorderSizePixel = 0
        sliderBg.Parent = container
        
        local sliderBgCorner = Instance.new("UICorner")
        sliderBgCorner.CornerRadius = UDim.new(0, 6)
        sliderBgCorner.Parent = sliderBg
        
        local sliderFill = Instance.new("Frame")
        sliderFill.Size = UDim2.new((default - min) / (max - min), 0, 1, 0)
        sliderFill.BackgroundColor3 = color
        sliderFill.BorderSizePixel = 0
        sliderFill.Parent = sliderBg
        
        local sliderFillCorner = Instance.new("UICorner")
        sliderFillCorner.CornerRadius = UDim.new(0, 6)
        sliderFillCorner.Parent = sliderFill
        
        local sliderBtn = Instance.new("TextButton")
        sliderBtn.Size = UDim2.new(1, 0, 1, 0)
        sliderBtn.BackgroundTransparency = 1
        sliderBtn.Text = ""
        sliderBtn.Parent = sliderBg
        
        local dragging = false
        
        sliderBtn.MouseButton1Down:Connect(function()
            dragging = true
        end)
        
        UIS.InputEnded:Connect(function(input)
            if input.UserInputType == Enum.UserInputType.MouseButton1 or 
               input.UserInputType == Enum.UserInputType.Touch then
                dragging = false
            end
        end)
        
        RunService.RenderStepped:Connect(function()
            if dragging then
                local mouse = UIS:GetMouseLocation()
                local relativeX = mouse.X - sliderBg.AbsolutePosition.X
                local percent = math.clamp(relativeX / sliderBg.AbsoluteSize.X, 0, 1)
                
                sliderFill.Size = UDim2.new(percent, 0, 1, 0)
                local value = math.floor(min + (max - min) * percent)
                
                if valueVar == "FLY_POWER" then
                    FLY_POWER = value
                elseif valueVar == "UP_POWER" then
                    UP_POWER = value
                elseif valueVar == "EXPLOSION_RADIUS" then
                    EXPLOSION_RADIUS = value
                end
                
                label.Text = labelText .. value
            end
        end)
    end

    -- å‰µå»ºä¸‰å€‹æ»‘æ¡¿
    createSlider(UDim2.new(0, 8, 0, 123), "âš¡ æ©«å‘ï¼š", Color3.fromRGB(0, 255, 150), 1000, 50000, 16000, "FLY_POWER")
    createSlider(UDim2.new(0, 8, 0, 186), "â¬†ï¸ å‚ç›´ï¼š", Color3.fromRGB(255, 200, 50), 0, 20000, 6000, "UP_POWER")
    createSlider(UDim2.new(0, 8, 0, 249), "ğŸ’¥ ç¯„åœï¼š", Color3.fromRGB(255, 100, 200), 5, 100, 15, "EXPLOSION_RADIUS")

    -- ================== æ‹–æ‹½åŠŸèƒ½ ==================
    local dragging = false
    local dragInput, dragStart, startPos

    local function update(input)
        local delta = input.Position - dragStart
        mainFrame.Position = UDim2.new(
            startPos.X.Scale, startPos.X.Offset + delta.X,
            startPos.Y.Scale, startPos.Y.Offset + delta.Y
        )
    end

    titleBar.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 or 
           input.UserInputType == Enum.UserInputType.Touch then
            dragging = true
            dragStart = input.Position
            startPos = mainFrame.Position
            
            input.Changed:Connect(function()
                if input.UserInputState == Enum.UserInputState.End then
                    dragging = false
                end
            end)
        end
    end)

    titleBar.InputChanged:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseMovement or 
           input.UserInputType == Enum.UserInputType.Touch then
            dragInput = input
        end
    end)

    UIS.InputChanged:Connect(function(input)
        if input == dragInput and dragging then
            update(input)
        end
    end)

    -- ================== æŒ‰éˆ•åŠŸèƒ½ ==================
    -- é—œé–‰æŒ‰éˆ•
    btnClose.MouseButton1Click:Connect(function()
        -- é—œé–‰åŠŸèƒ½ï¼Œæ¢å¾©æ‰€æœ‰ç‹€æ…‹
        ENABLED = false
        for part, _ in pairs(highlights) do
            removeHighlight(part)
        end
        disableTouchMode()
        
        -- ç¢ºä¿åœæ­¢æ—‹è½‰
        if spinConnection then
            spinConnection:Disconnect()
            spinConnection = nil
        end
        
        sg:Destroy()
    end)

    -- ç¸®å°æŒ‰éˆ•
    local minimized = false
    btnMinimize.MouseButton1Click:Connect(function()
        minimized = not minimized
        if minimized then
            mainFrame:TweenSize(
                UDim2.new(0, 200, 0, 42),
                Enum.EasingDirection.Out,
                Enum.EasingStyle.Quad,
                0.3,
                true
            )
            btnMinimize.Text = "+"
            contentFrame.Visible = false
        else
            mainFrame:TweenSize(
                UDim2.new(0, 200, 0, 370),
                Enum.EasingDirection.Out,
                Enum.EasingStyle.Quad,
                0.3,
                true
            )
            btnMinimize.Text = "âˆ’"
            contentFrame.Visible = true
        end
    end)

    -- ä¸»é–‹é—œæŒ‰éˆ•
    btnMain.MouseButton1Click:Connect(function()
        ENABLED = not ENABLED
        btnMain.Text = ENABLED and "â— é–‹å•Ÿ" or "â— é—œé–‰"
        btnMain.BackgroundColor3 = ENABLED and Color3.fromRGB(50, 220, 100) or Color3.fromRGB(220, 50, 80)
        
        if ENABLED then
            -- å»¶é²æƒæï¼Œé¿å…é–‹å•Ÿç¬é–“å¡é “
            task.wait(0.1)
            scanUnanchoredParts()
        else
            for part, _ in pairs(highlights) do
                removeHighlight(part)
            end
            disableTouchMode()
        end
    end)

    -- æ¨¡å¼åˆ‡æ›æŒ‰éˆ•
    btnMode.MouseButton1Click:Connect(function()
        disableTouchMode()
        
        if MODE == "é»æ“Š" then
            MODE = "è§¸ç¢°"
            btnMode.Text = "ğŸ¯ æ¨¡å¼ï¼šè§¸ç¢°"
        elseif MODE == "è§¸ç¢°" then
            MODE = "ç¯„åœ"
            btnMode.Text = "ğŸ¯ æ¨¡å¼ï¼šç¯„åœ"
            rangeModeTrigger = true  -- ç«‹å³å…è¨±è§¸ç™¼
            lastExplosion = 0  -- é‡ç½®è¨ˆæ™‚å™¨
        else
            MODE = "é»æ“Š"
            btnMode.Text = "ğŸ¯ æ¨¡å¼ï¼šé»æ“Š"
        end
    end)
end
createGUI()

-- ================== ä¸»å¾ªç’° ==================
local heartbeatCount = 0
RunService.Heartbeat:Connect(function()
    if not ENABLED then 
        if next(flingCooldowns) then
            flingCooldowns = {}
        end
        return 
    end
    
    -- æ¯5å¹€æ‰æª¢æŸ¥ä¸€æ¬¡ï¼Œé™ä½è² æ“”
    heartbeatCount = heartbeatCount + 1
    if heartbeatCount % 5 ~= 0 then return end
    
    local now = tick()
    
    -- é«˜äº®æƒæï¼ˆé™ä½é »ç‡åˆ°1ç§’ï¼‰
    if now - lastScan >= SCAN_INTERVAL then
        updateHighlights()
        -- åˆ†æ‰¹æƒæï¼Œæ¯æ¬¡åªè™•ç†éƒ¨åˆ†
        task.spawn(scanUnanchoredParts)
        lastScan = now
    end
    
    -- ç¯„åœæ¨¡å¼ï¼šæ¯0.15ç§’è‡ªå‹•çˆ†ç‚¸
    if MODE == "ç¯„åœ" and now - lastExplosion >= EXPLOSION_INTERVAL then
        explosionFlingAroundPlayer()
        lastExplosion = now
    end
    
    -- è§¸ç¢°æ¨¡å¼ï¼šå•Ÿç”¨é«˜è³ªé‡
    if MODE == "è§¸ç¢°" then
        enableTouchMode()
    else
        disableTouchMode()
    end
end)

-- ================== é»æ“Šæ¨¡å¼ ==================
UIS.TouchTap:Connect(function(positions, processed)
    if not ENABLED or processed or MODE ~= "é»æ“Š" then return end
    
    local touchPos = positions[1]
    local ray = cam:ScreenPointToRay(touchPos.X, touchPos.Y)
    local params = RaycastParams.new()
    params.FilterType = Enum.RaycastFilterType.Blacklist
    params.FilterDescendantsInstances = {player.Character}
    
    local result = Workspace:Raycast(ray.Origin, ray.Direction * 999, params)
    
    if result and result.Instance then
        flingPart(result.Instance)
    end
end)

-- ================== è¼‰å…¥æç¤º ==================
game.StarterGui:SetCore("SendNotification", {
    Title = "ğŸš€ æ’é£›è…³æœ¬ v5.8";
    Text = "âœ… æƒæç¯„åœï¼š100æ ¼\nğŸ’ª è§¸ç¢°è³ªé‡ï¼š50è¬\nğŸŒªï¸ è§¸ç¢°æ¨¡å¼ï¼šé«˜é€Ÿæ—‹è½‰ï¼\nè®Šæˆæ—‹è½‰ç ´å£çƒï¼";
    Duration = 6;
})
